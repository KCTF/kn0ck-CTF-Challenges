# baby_crypto

### [题目描述]：
```
附件：crypto.py
附件：data.txt
```

### [题目考点]：
```
1. 差分攻击
2. 逆推加密算法，求子密钥
```

### [题目制作过程]：
1. 附件crypto.py直接提供。
2. 编辑 “附件data生成” 文件夹中的 “flag.py” ,修改flag。
3. 附件data.txt可由 “附件data生成” 文件夹中执行 “data及输出整理生成.py ” 生成。同时生成的key.txt 是对data.txt的整理，可用于后续的解题，不提供给选手，仅留档制作exp。

### [题目writeup]：

1. 查看题目的crypto.py，提供的一个类feal-4算法，有一定魔改，附件data.txt为一段输入输出数据流

2. 针对类feal4算法可以采用差分攻击，观察提供的输入数据存在差分关系，一共是48对输入输出，以每6对输入输出为一组，6个之中，相邻的两个输入异或分别为（0x0080800000000000 , 0x0080800000808000 , 0x0002000000828000），一共有8组这样的差分数据，求解其实大概需要5组左右就够了，全部使用可以避免一些意外情况。

3. 加密代码关键部分
```
def gbox(a,b,mode):
    x = (a+b+mode)%256
    return ((x<<2)|(x>>6))&0xff

def fbox(plain):
    t0 = (plain[3] ^ plain[0])
    y1 = gbox(plain[1] ^ plain[2], t0, 1)
    y0 = gbox(plain[1], y1, 0)
    y2 = gbox(t0, y1, 0)
    y3 = gbox(plain[0], y2, 1)
    return [y3, y0, y1, y2]
```
 		发现gbox设计不变，基于gbox设计的fbox在返回值上进行了移位，所以在fbox仍然存在差分特征，此处表现为两个输入异或为00808000时，输出异或固定为00020000。利用提供的具有差分特征的输入输出，可以逆推子密钥

4. 编写data.py，对数据data.txt进行整理
5. 编写 exp.c, 运行 “gcc exp.c -o exp”编译，，运行exp求解子密钥
6. 带入子密钥 ，求解flag，详细代码请从 “解题” 文件夹获取

### 注意事项
+ 求解子密钥需要一定时间进行爆破